#cloud-config
users:
  - default
  - name: workshopadmin
    gecos: workshopadmin
    primary_group: admin
    groups: users
    sudo: ALL=(ALL) NOPASSWD:ALL
    lock_passwd: false
    passwd: $y$j9T$8TDsAZHi0cxeXEimHRuYm.$WyJFkLkvyCf2xhxkMKeF/XVmSLgiJl6q.mchlyV2GEA
package upgrade: true
package_upgrade: true
packages:
  - apache2
  - nodejs
  - npm
runcmd:
  - sudo mkdir /source && cd /source
  - sudo mkdir /nodeProject
  - sudo npm init -y 
  - sudo npm install -g express
  - sudo npm install @azure/storage-blob
  - sudo npm install cors
  - sudo npm install body-parser
  - sudo service apache2 start
  - sudo wget https://ws1clsansfire.blob.core.windows.net/workshopcode/website_code.tar
  - sudo tar -xvf website_code.tar -C /
  - sudo mv /source/website_code/* /var/www/html/
  - sudo a2enmod rewrite
  - sudo apache2ctl configtest
  - sudo systemctl reload apache2
  - sudo systemctl restart apache2.service
write_files:
  - path: /var/www/old_index.html
    permissions: "0644"
    content: |
      flag: CT{H4rd22222222f1nDDd}
    owner: www-data:www-data